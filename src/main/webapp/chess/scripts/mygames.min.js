function loadGame(e){if(lastKey!=0){document.getElementById("game_"+lastKey).style.background="white"}document.getElementById("game_"+e).style.background="gray";lastKey=e;loading_flag=true;$("#pgn_string").html("Loading...");$.getJSON("pgnparser/moves.htm",{gameNo:e},function(t){moveList=t.moveList;$.getJSON("pgnparser/pgn.htm",{gameNo:e},function(e){$("#pgn_string").html(e.pgnString);loading_flag=false})});currentMoveNo=-1;oldMoveNo=-1;pause();var t,n;for(var r=0;r<=63;r++){n=$("#square_"+r).children("img");if(n.length!=0){n.remove()}}for(var r=0;r<=63;r++){t=$("#square_"+r);if(r>=16&&r<=47){continue}else if(r>=48&&r<=55){t.append(wpawn)}else if(r>=8&&r<=15){t.append(bpawn)}else if(r>=0&&r<=7){if(r==0||r==7){t.append(brook)}else if(r==1||r==6){t.append(bknight)}else if(r==2||r==5){t.append(bbishop)}else if(r==3){t.append(bqueen)}else if(r==4){t.append(bking)}}else if(r>=56&&r<=63){if(r==56||r==63){t.append(wrook)}else if(r==57||r==62){t.append(wknight)}else if(r==58||r==61){t.append(wbishop)}else if(r==59){t.append(wqueen)}else if(r==60){t.append(wking)}}}return false}function begin(){if(loading_flag){return}pause();while(currentMoveNo>=0){goback()}}function goback(){if(loading_flag||currentMoveNo<0){return}pause();var e=moveList[currentMoveNo];var t=e>>>12&7;var n=e>>>15&7;var r=e&63;var i=e>>>6&63;var s=e>>>18&7;if(t==PAWN&&n==EMPTY){var o=r-i;if(o==7||o==9||o==-7||o==-9){if(currentMoveNo%2==0){$("#square_"+(i+8)).append(bpawn)}else{$("#square_"+(i-8)).append(wpawn)}}}var u=$("#square_"+i).children("img");if(s==EMPTY){$("#square_"+r).append(u)}else{u.remove();if(currentMoveNo%2==0){$("#square_"+r).append(wpawn)}else{$("#square_"+r).append(bpawn)}}if(n!=EMPTY){var a=$("#square_"+i);if(currentMoveNo%2==0){if(n==QUEEN){a.append(bqueen)}else if(n==ROOK){a.append(brook)}else if(n==BISHOP){a.append(bbishop)}else if(n==KNIGHT){a.append(bknight)}else if(n==PAWN){a.append(bpawn)}}else{if(n==QUEEN){a.append(wqueen)}else if(n==ROOK){a.append(wrook)}else if(n==BISHOP){a.append(wbishop)}else if(n==KNIGHT){a.append(wknight)}else if(n==PAWN){a.append(wpawn)}}}if(t==KING){if(r==60&&i==62){from_piece=$("#square_61").children("img");$("#square_63").append(from_piece)}else if(r==60&&i==58){from_piece=$("#square_59").children("img");$("#square_56").append(from_piece)}else if(r==4&&i==6){from_piece=$("#square_5").children("img");$("#square_7").append(from_piece)}else if(r==4&&i==2){from_piece=$("#square_3").children("img");$("#square_0").append(from_piece)}}currentMoveNo--;changeFocusToCurrentMove()}function goforward(e){if(loading_flag||currentMoveNo>=moveList.length+1){return}if(!e){pause()}currentMoveNo++;var t=moveList[currentMoveNo];var n=t>>>12&7;var r=t&63;var i=t>>>6&63;var s=t>>>18&7;var o=$("#square_"+i).children("img");if(o.length==0){sq_diff=r-i;if(n==PAWN&&(sq_diff==7||sq_diff==9||sq_diff==-7||sq_diff==-9)){if(currentMoveNo%2==0){o=$("#square_"+(i+8)).children("img")}else{o=$("#square_"+(i-8)).children("img")}o.remove()}}else{o.remove()}var u=$("#square_"+r).children("img");if(s==EMPTY){$("#square_"+i).append(u)}else{u.remove();if(currentMoveNo%2==0){if(s==QUEEN){$("#square_"+i).append(wqueen)}else if(s==KNIGHT){$("#square_"+i).append(wknight)}else if(s==ROOK){$("#square_"+i).append(wrook)}else if(s==BISHOP){$("#square_"+i).append(wbishop)}}else{if(s==QUEEN){$("#square_"+i).append(bqueen)}else if(s==KNIGHT){$("#square_"+i).append(bknight)}else if(s==ROOK){$("#square_"+i).append(brook)}else if(s==BISHOP){$("#square_"+i).append(bbishop)}}}if(n==KING){if(r==60&&i==62){u=$("#square_63").children("img");$("#square_61").append(u)}else if(r==60&&i==58){u=$("#square_56").children("img");$("#square_59").append(u)}else if(r==4&&i==6){u=$("#square_7").children("img");$("#square_5").append(u)}else if(r==4&&i==2){u=$("#square_0").children("img");$("#square_3").append(u)}}changeFocusToCurrentMove()}function end(){if(loading_flag){return}pause();while(currentMoveNo<moveList.length){goforward()}}function goToPosition(e){if(loading_flag){return}pause();if(currentMoveNo>e){while(currentMoveNo>e){goback()}}else if(currentMoveNo<e){while(currentMoveNo<e){goforward()}}changeFocusToCurrentMove()}function play(){if(loading_flag){return}playMode=true;$("#playBtn").hide();$("#pauseBtn").show()}function pause(){playMode=false;$("#pauseBtn").hide();$("#playBtn").show()}function changeFocusToCurrentMove(){if(currentMoveNo<0||currentMoveNo>=moveList.length){return}if(oldMoveNo!=-1){document.getElementById("pgn_"+oldMoveNo).style.background="white"}document.getElementById("pgn_"+currentMoveNo).style.background="gray";oldMoveNo=currentMoveNo}function filter(e,t){sel=e.value;for(var n=1;n<=t;n++){$("#game_"+n).show();if(sel=="imgm"){if(n!=39&&n!=51){$("#game_"+n).hide()}}else if(sel=="fav"){if(n!=15&&n!=22&&n!=27&&n!=34&&n!=35&&n!=39&&n!=41&&n!=42&&n!=49&&n!=50&&n!=51){$("#game_"+n).hide()}}}if(sel=="all"){loadGame(1)}else if(sel=="imgm"){loadGame(39)}else{loadGame(15)}}$(document).ready(function(){function e(){if(playMode&&!loading_flag){goforward(true);if(currentMoveNo>=moveList.length+1){pause()}}}setInterval(e,1e3)});var moveList;var currentMoveNo=-1;var wking="<img src='images/WK.png' style='position:relative; top:10%; left:10%;'>";var wqueen="<img src='images/WQ.png' style='position:relative; top:10%; left:10%;'>";var wrook="<img src='images/WR.png' style='position:relative; top:10%; left:10%;'>";var wbishop="<img src='images/WB.png' style='position:relative; top:10%; left:10%;'>";var wknight="<img src='images/WN.png' style='position:relative; top:10%; left:10%;'>";var wpawn="<img src='images/WP.png' style='position:relative; top:18%; left:24%;'>";var bking="<img src='images/BK.png' style='position:relative; top:10%; left:10%;'>";var bqueen="<img src='images/BQ.png' style='position:relative; top:10%; left:10%;'>";var brook="<img src='images/BR.png' style='position:relative; top:10%; left:10%;'>";var bbishop="<img src='images/BB.png' style='position:relative; top:10%; left:10%;'>";var bknight="<img src='images/BN.png' style='position:relative; top:10%; left:10%;'>";var bpawn="<img src='images/BP.png' style='position:relative; top:10%; left:24%;'>";var EMPTY=0;var ROOK=1;var KNIGHT=2;var BISHOP=3;var QUEEN=4;var KING=5;var PAWN=6;var oldMoveNo=-1;var playMode=false;var loading_flag=false;var lastKey=0